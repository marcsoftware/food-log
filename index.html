
<!DOCTYPE html>
<html>
<title>INDEX</title>
<head>
  <script src="constants.js"></script>
<script>


window.onload=init;

function init(){
    GetURLParameter();
}
//-------------------------------------------------------------
// get code url parameter from fitit
//-------------------------------------------------------------
function GetURLParameter(){
          var pageURL = window.location.search.substring(1);
          var code = pageURL.match(/[0-9a-zA-Z]+/g);
          getAuthCode(code[1]);

          
}



//--------------------------------------------------------------------------------------------------------------------------------
// use CODE to get AUTHCODE
//--------------------------------------------------------------------------------------------------------------------------------
var callback_url = `http://localhost:8080`;
    function getAuthCode(code) {
          console.log('getAuthCode(){]'+code);
        
        var xhttp = new XMLHttpRequest();
      

      
      xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var token =  JSON.parse(this.responseText).access_token;
            
            
          
           localStorage.setItem("authcode", token);
          document.getElementById('result').innerHTML+='done';
        }
      };

      
      
      
      xhttp.open("POST", `https://api.fitbit.com/oauth2/token?code=${code}&grant_type=authorization_code&redirect_uri=${callback_url}`, true);
      xhttp.setRequestHeader('Authorization', 'Basic MjJCVlpDOmRjMTFjNzYwNTA4MjRmYjUwMWRjODhmNWRjYzRlOWE0'); // THIS is base64 of id and another thing.
      xhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

      xhttp.send();
    }

</script>
</head>
<body>

<h2>get authocde</h2>

<button type="button" onclick="GetURLParameter()">Try it</button>
<p id="result">...</p>
</body>
</html> 


